var Structure,slice=[].slice,indexOf=[].indexOf||function(t){for(var n=0,e=this.length;n<e;n++)if(n in this&&this[n]===t)return n;return-1},hasProp={}.hasOwnProperty;exports.Structure=Structure=function(){function t(){var t,n,e,r;for(n=1<=arguments.length?slice.call(arguments,0):[],this.computedAttributes={},this.externalAttributes={},this.parentNode=null,this.childList=[],e=0,r=n.length;e<r;e++)t=n[e],this.insertChild(t,this.childList.length)}var n,e,r,i,s;return t.prototype.IDs=[],t.instanceWithID=function(n){return t.prototype.IDs[n]},t.nextUnusedID=function(){var n;return(n=t.prototype.IDs.indexOf(null))>=0?n:t.prototype.IDs.length},t.prototype.getID=function(){if(null==this.ID)return this.ID=t.nextUnusedID(),t.prototype.IDs[this.ID]=this},t.prototype.releaseID=function(){var n;if(null!=this.ID){for(t.prototype.IDs[this.ID]=null,delete this.ID,n=[];null===t.prototype.IDs[t.prototype.IDs.length-1];)n.push(t.prototype.IDs.pop());return n}},t.prototype.subclasses={},t.addSubclass=function(n,e){return t.prototype.subclasses[n]=e,n},t.prototype.className=t.addSubclass("Structure",t),t.prototype.toJSON=function(){var t;return{className:this.className,computedAttributes:this.computedAttributes,externalAttributes:this.externalAttributes,children:function(){var n,e,r,i;for(i=[],n=0,e=(r=this.childList).length;n<e;n++)t=r[n],i.push(t.toJSON());return i}.call(this)}},t.fromJSON=function(n){var e,r,i,s;return i=t.prototype.subclasses[n.className],r=function(){var r,i,s,o;for(o=[],r=0,i=(s=n.children).length;r<i;r++)e=s[r],o.push(t.fromJSON(e));return o}(),s=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(i,r,function(){}),s.computedAttributes=JSON.parse(JSON.stringify(n.computedAttributes)),s.externalAttributes=JSON.parse(JSON.stringify(n.externalAttributes)),s},t.prototype.parent=function(){return this.parentNode},t.prototype.children=function(){return this.childList.slice(0)},t.prototype.indexInParent=function(){var t,n;return null!=(t=this.parentNode)&&null!=(n=t.childList)?n.indexOf(this):void 0},t.prototype.previousSibling=function(){var t;if(null!=(t=this.indexInParent()))return this.parentNode.childList[t-1]},t.prototype.nextSibling=function(){var t;if(null!=(t=this.indexInParent()))return this.parentNode.childList[t+1]},t.prototype.removeFromParent=function(){var t,n;if(null!=(n=this.parentNode))return t=this.indexInParent(),this.parentNode.childList.splice(t,1),this.parentNode=null,"function"==typeof this.wasRemoved?this.wasRemoved(n,t):void 0},t.prototype.removeChild=function(t){var n;return null!=(n=this.childList[t])?n.removeFromParent():void 0},t.prototype.insertChild=function(n,e){var r;if(null==e&&(e=0),n instanceof t&&n!==this&&0<=e&&e<=this.childList.length){for(r=this;null!=(r=r.parent());)if(r===n){this.removeFromParent();break}return n.removeFromParent(),this.childList=slice.call(this.childList.slice(0,e)).concat([n],slice.call(this.childList.slice(e))),n.parentNode=this,"function"==typeof n.wasInserted?n.wasInserted():void 0}},t.prototype.replaceWith=function(t){var n,e;if(null!=(e=this.parentNode))return n=this.indexInParent(),this.removeFromParent(),e.insertChild(t,n)},t.prototype.copy=function(){var n,e;return e=new t,e.computedAttributes=JSON.parse(JSON.stringify(this.computedAttributes)),e.externalAttributes=JSON.parse(JSON.stringify(this.externalAttributes)),e.childList=function(){var t,e,r,i;for(i=[],t=0,e=(r=this.childList).length;t<e;t++)n=r[t],i.push(n.copy());return i}.call(this),e},t.prototype.isEarlierThan=function(n){var e,r,i,s,o,l,u,c;if(n instanceof t){if(n===this)return!1;for(e=[n];null!=(s=e[0].parent());)e.unshift(s);for(c=this,u=null;null!=c&&indexOf.call(e,c)<0;)u=c,c=c.parent();if(null!=c)return c===this||c!==n&&(r=e.indexOf(c),l=e[r+1],i=u.indexInParent(),o=l.indexInParent(),i<o)}},t.prototype.getComputedAttribute=function(t){return this.computedAttributes[t]},t.prototype.setComputedAttribute=function(t,n){if(this.computedAttributes[t]!==n)return this.computedAttributes[t]=n,"function"==typeof this.wasChanged?this.wasChanged():void 0},t.prototype.clearComputedAttributes=function(){var t,n,e,r,i;for(0===(e=1<=arguments.length?slice.call(arguments,0):[]).length&&(e=Object.keys(this.computedAttributes)),i=[],t=0,r=e.length;t<r;t++)(n=e[t])in this.computedAttributes?(delete this.computedAttributes[n],i.push("function"==typeof this.wasChanged?this.wasChanged():void 0)):i.push(void 0);return i},t.prototype.compute=function(){var t,n,e,r,i,s,o;for(o=[],r=0,i=(n=1<=arguments.length?slice.call(arguments,0):[]).length;r<i;r++)(t=n[r])instanceof Array||(t=[t]),e=t[0],s=2<=t.length?slice.call(t,1):[],o.push(this.setComputedAttribute(e,this[e].apply(this,s)));return o},t.prototype.getExternalAttribute=function(t){return this.externalAttributes[t]},t.prototype.setExternalAttribute=function(t,n){if(this.externalAttributes[t]!==n)return this.externalAttributes[t]=n,"function"==typeof this.wasChanged?this.wasChanged():void 0},t.prototype.clearExternalAttributes=function(){var t,n,e,r,i;for(0===(e=1<=arguments.length?slice.call(arguments,0):[]).length&&(e=Object.keys(this.externalAttributes)),i=[],t=0,r=e.length;t<r;t++)(n=e[t])in this.externalAttributes?(delete this.externalAttributes[n],i.push("function"==typeof this.wasChanged?this.wasChanged():void 0)):i.push(void 0);return i},t.prototype.attr=function(t){var n,e;for(n in t)hasProp.call(t,n)&&(e=t[n],this.setExternalAttribute(n,e));return this},t.prototype.setup=function(){var t,n,e,r;return(e=function(t){var n,r,i,s,o;for(t.getID(),o=[],r=0,i=(s=t.children()).length;r<i;r++)n=s[r],o.push(e(n));return o})(this),r={},(n=function(t){var e,i,s,o,l,u;for(null!=(i=t.getExternalAttribute("id"))&&(r[i]=t,t.clearExternalAttributes("id")),u=[],s=0,o=(l=t.children()).length;s<o;s++)e=l[s],u.push(n(e));return u})(this),(t=function(n){var e,i,s,o,l,u,c,h,a,p,f;for(s=0,l=(c=["label","premise","reason"]).length;s<l;s++)e=c[s],null!=(f=n.getExternalAttribute(e+" for"))&&(null!=(p="previous"===f?n.previousSibling():"next"===f?n.nextSibling():r.hasOwnProperty(f)?r[f]:null)&&n.connectTo(p,e),n.clearExternalAttributes(e+" for"));for(a=[],o=0,u=(h=n.children()).length;o<u;o++)i=h[o],a.push(t(i));return a})(this),this.fillOutConnections(),this},t.prototype.fillOutConnections=function(){var n,e,r,i,s,o,l,u,c,h,a,p,f,d,b,g,y,x,v,A,I,m,O,D,S;for(o=0,l=(f=this.childList).length;o<l;o++)f[o].fillOutConnections();if(null!=this.ID){a=function(t){var n,e,r,i,s,o;i=[];for(s in t)if(hasProp.call(t,s)){e=t[s];for(o in e)if(hasProp.call(e,o))for(n=1,r=e[o];1<=r?n<=r:n>=r;1<=r?++n:--n)i.push([Number(s),o])}return i},p=(r=function(t){var n,e,r,i,s,o,l;for(s={},r=0,i=t.length;r<i;r++)o=(e=t[r])[0],l=e[1],null==s[o]&&(s[o]={}),null==(n=s[o])[l]&&(n[l]=0),s[o][l]++;return s})(null!=(d=this.getExternalAttribute("connectionsOut"))?d:[]);for(O in p)if(hasProp.call(p,O)&&(u=p[O],null!=(e=t.instanceWithID(O)))){null==(D=r(null!=(b=e.getExternalAttribute("connectionsIn"))?b:[]))[c=this.ID]&&(D[c]={});for(S in u)hasProp.call(u,S)&&(i=u[S],u[S]=D[this.ID][S]=Math.max(i,null!=(g=D[this.ID][S])?g:0));e.setExternalAttribute("connectionsIn",a(D))}s=r(null!=(y=this.getExternalAttribute("connectionsIn"))?y:[]),A=[];for(I in s)if(hasProp.call(s,I)&&(u=s[I],null!=(n=t.instanceWithID(I)))){null==(m=r(null!=(x=n.getExternalAttribute("connectionsOut"))?x:[]))[h=this.ID]&&(m[h]={});for(S in u)hasProp.call(u,S)&&(i=u[S],u[S]=m[this.ID][S]=Math.max(i,null!=(v=m[this.ID][S])?v:0));A.push(n.setExternalAttribute("connectionsOut",a(m)))}return A}},t.prototype.connectTo=function(n,e){var r,i,s,o;return null!=this.ID&&n instanceof t&&null!=n.ID&&(i=null!=(s=this.getExternalAttribute("connectionsOut"))?s:[],r=null!=(o=n.getExternalAttribute("connectionsIn"))?o:[],i.push([n.ID,e]),r.push([this.ID,e]),this.setExternalAttribute("connectionsOut",i),n.setExternalAttribute("connectionsIn",r),!0)},t.prototype.disconnectFrom=function(n,e){var r,i,s,o,l,u;if(!(null!=this.ID&&n instanceof t&&null!=n.ID))return!1;for(o=null!=(l=this.getExternalAttribute("connectionsOut"))?l:[],i=null!=(u=n.getExternalAttribute("connectionsIn"))?u:[],s=r=0;s<o.length&&(o[s][0]!==n.ID||o[s][1]!==e);)s++;if(s===o.length)return!1;for(;r<i.length&&(i[r][0]!==this.ID||i[r][1]!==e);)r++;return r!==i.length&&(o.splice(s,1),i.splice(r,1),this.setExternalAttribute("connectionsOut",o),n.setExternalAttribute("connectionsIn",i),!0)},t.prototype.allConnectionsOut=function(t){var n,e,r,i,s,o;if(i=null!=(s=this.getExternalAttribute("connectionsOut"))?s:[],null==t)return i;for(o=[],e=0,r=i.length;e<r;e++)(n=i[e])[1]===t&&o.push(n[0]);return o},t.prototype.allConnectionsIn=function(t){var n,e,r,i,s,o;if(e=null!=(s=this.getExternalAttribute("connectionsIn"))?s:[],null==t)return e;for(o=[],r=0,i=e.length;r<i;r++)(n=e[r])[1]===t&&o.push(n[0]);return o},t.prototype.allConnectionsTo=function(n){var e,r,i,s,o,l;if(!(n instanceof t&&null!=n.ID))return null;for(l=[],r=0,i=(s=null!=(o=this.getExternalAttribute("connectionsOut"))?o:[]).length;r<i;r++)(e=s[r])[0]===n.ID&&l.push(e[1]);return l},t.prototype.properties=function(){var n,e,r,i,s,o,l,u;for(l={},e=0,r=(o=null!=(s=this.getExternalAttribute("connectionsIn"))?s:[]).length;e<r;e++)n=o[e],null!=(u=t.instanceWithID(n[0]))&&(null!=l[i=n[1]]?l[i]:l[i]=[]).push(u);return l},t.prototype.isAccessibleTo=function(n){return n instanceof t&&(null!=n.parent()&&(this.parent()===n.parent()?this.indexInParent()<n.indexInParent():this.isAccessibleTo(n.parent())))},t.prototype.isInTheScopeOf=function(t){return t.isAccessibleTo(this)},t.prototype.iteratorOverAccessibles=function(){return{ancestor:this,sibling:this,next:function(){return null==this.ancestor?null:null!=(this.sibling=this.sibling.previousSibling())?this.sibling:(this.sibling=this.ancestor=this.ancestor.parent(),this.next())}}},t.prototype.iteratorOverScope=function(){return{chain:[this],next:function(){var t,n;if(0===this.chain.length)return null;if(t=this.chain.pop(),null!=(n=t.nextSibling())){for(this.chain.push(n);null!=(n=n.children()[0]);)this.chain.push(n);return this.chain[this.chain.length-1]}return this.chain.length>0?this.chain[this.chain.length-1]:null}}},r=function(t,n){var e;for(null==n&&(n=function(){return!0});null!=(e=t.next());)if(n(e))return e},n=function(t,n){var e,r;for(null==n&&(n=function(){return!0}),r=[];null!=(e=t.next());)n(e)&&r.push(e);return r},t.prototype.firstAccessible=function(t){return null==t&&(t=function(){return!0}),r(this.iteratorOverAccessibles(),t)},t.prototype.allAccessibles=function(t){return null==t&&(t=function(){return!0}),n(this.iteratorOverAccessibles(),t)},t.prototype.firstInScope=function(t){return null==t&&(t=function(){return!0}),r(this.iteratorOverScope(),t)},t.prototype.allInScope=function(t){return null==t&&(t=function(){return!0}),n(this.iteratorOverScope(),t)},t.prototype.text=function(){return this.getExternalAttribute("text")},t.prototype.isAReference=function(){return!!this.getExternalAttribute("reference")},i=function(t,n){var e,r,i,s,o,l,u;for(r=t.getExternalAttribute(n),e=t.getComputedAttribute(n),r instanceof Array||(r=[]),e instanceof Array||(e=[]),u=[],s=0,o=(l=slice.call(r).concat(slice.call(e))).length;s<o;s++)"string"==typeof(i=l[s])&&u.push(i);return u},e=function(n,e){var r,i,s,o,l,u;for(u=[],i=0,s=(l=n.allConnectionsIn(e)).length;i<s;i++)r=l[i],null!=(o=t.instanceWithID(r))&&u.push(o);return u},s=function(t){var n,e,r,i;for(i=[],e=0,r=t.length;e<r;e++)n=t[e],indexOf.call(i,n)<0&&i.push(n);return i},t.prototype.labels=function(){var t,n,r,o,l,u;for(l=slice.call(i(this,"labels")).concat(slice.call(function(){var t,r,i,s;for(s=[],t=0,r=(i=e(this,"label")).length;t<r;t++)(n=i[t]).text()&&s.push(n.text());return s}.call(this))),u=[],t=0,r=(o=s(l)).length;t<r;t++)""!==(n=o[t])&&u.push(n);return u},t.prototype.hasLabel=function(t){return indexOf.call(this.labels(),t)>=0},t.prototype.reasons=function(){return slice.call(i(this,"reasons")).concat(slice.call(e(this,"reason")))},t.prototype.premises=function(){return slice.call(i(this,"premises")).concat(slice.call(e(this,"premise")))},t.prototype.lookup=function(t){return this.firstAccessible(function(n){return n.hasLabel(t)})},t.prototype.cites=function(t){var n,e,r,i,s,o,l,u;for(u=[],r=0,o=(n=slice.call(this.reasons()).concat(slice.call(this.premises()))).length;r<o;r++){if((e=n[r])===t)return!0;"string"==typeof e&&u.push(e),("function"==typeof e.isAReference?e.isAReference():void 0)&&u.push(e.text())}for(i=0,l=u.length;i<l;i++)if(s=u[i],t===this.lookup(s))return!0;return!1},t.prototype.whatCitesMe=function(){return this.allInScope(function(t){return function(n){return n.cites(t)}}(this))},t}();
//# sourceMappingURL=structure.js.map
